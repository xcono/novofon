openapi: 3.0.0
info:
    title: Загрузка звонков и разговоров
    version: 1.0.0
    description: Загрузка звонков и разговоров для речевой или сквозной аналитики
paths:
    /upload.calls:
        post:
            summary: Загрузка звонков и разговоров
            description: |-
                Загрузка звонков и разговоров для речевой или сквозной аналитики

                **Request Parameters:** 30

                - `url` (string, required): http/https адрес на которые будет отправлено уведомление об успешной обработке звонка.

                - `tag_id` (number, optional): Уникальный идентификатор тега в системе CoMagic

                - `mp3_records` (array, optional): Файлы разговора для прослушивания в личном кабинете. Запрещено передавать, если заполнен параметр wav_records

                - `user_id` (number, optional): Уникальный идентификатор пользователя клиента агента от имени которого делается запрос Является обязательным для агента Для получения списка пользователей клиента необходимо использовать метод "get.customer_users"

                - `is_lost` (boolean, required): Признак, что звонок потерянный или успешный

                - `is_transfer` (boolean, optional): Значение по умолчанию `false`. Признак, был ли трансфер в сессии звонка Порядок разговора сотрудников определяется в параметрах wav_records и mp3_records

                - `wait_duration` (number, optional): Длительность ожидания абонента до первого разговора с сотрудником. Значение в секундах.

                - `visitor_session_id` (number, optional): Уникальный идентификатор сессии посетителя полученной из CoMagic. Параметр нужен, если требуется аналитика рекламных кампаний.

                - `events` (array, required): Какие уведомления об обработке звонка получать

                - `tag_name` (string, required): Название тега. Ищем по названию тег в нашей системе, если не нашли, то создаем и ставим его на звонок. Если нашли, то ставим найденный тег на звонок. Поиск чувствительный к регистру. Для простановки тега "Продажа" необходимо использовать метод "set.tag_sales"Игнорируется, если заполнен tag_id

                - `calls` (array, required): Список звонков. Максимально 500

                - `start_time` (iso8601, required): Дата и время начала сессии звонка

                - `finish_time` (iso8601, required): Время окончания сессии звонка. Не может быть меньше чем start_time

                - `talk_duration` (number, optional): Длительность разговора - от момента первого разговора абонента с сотрудником до окончания разговора с последним сотрудником. Значение в секундах

                - `comment` (string, optional): Комментарий к звонку. Можно указывать название сервиса или формы, которые сгенерировали звонок.

                - `tags` (array, optional): Теги звонка

                - `employee_id` (number, optional): Уникальный идентификатор сотрудника в системе CoMagic

                - `access_token` (string, required): Ключ сессии аутентификации

                - `calling_phone_number` (string, required): Номер звонящего

                - `site_id` (number, optional): Уникальный идентификатор сайта в CoMagic Параметр игнорируется, если заполнен visitor_session_id или called_phone_number принадлежит другому сайту.

                - `callback` (object, optional): Уведомление об обработке звонка Формат уведомления JSON

                - `record_url` (string, required): Адрес по которому можно скачать файл разговора

                - `ext_id` (string, required): Уникальный идентификатор звонка в вашей системе. Если в системе уже есть успешно загруженный звонок или уже есть 3 попытки ошибочной загрузки звонка с данным ext_id, то данный звонок будет игнорирован.

                - `source_id` (number, optional): Уникальный идентификатор источника. Возможно передать только неудаленный источник в разрезе клиента. Если передан visitor_session_id, то определим source_id по параметрам сессии.

                - `wav_records` (array, optional): Файлы разговора для речевой аналитики Возможно передать только если подключен компонент "Речевая аналитика звонков". Из wav-файлов автоматически создаются mp3-записи для прослушивания в личном кабинете

                - `employee_name` (string, optional): Название сотрудника (ФИО)Ищем сотрудника по названию (ФИО) в нашей системе, если не нашли, то создаем и связываем его со звонком. Если нашли, то связываем его со звонком. Поиск не чувствительный к регистру. Игнорируется, если заполнен employee_id

                - `direction` (enum, optional): Направление звонка Значение по умолчанию 'in'

                - `called_phone_number` (string, required): Номер куда звонили

                - `campaign_id` (number, optional): Уникальный идентификатор рекламной кампании в CoMagic. Параметр игнорируется, если заполнен visitor_session_id

                - `employee_channel` (enum, required): Указывает в каком канале находится сотрудник Значения только left или right
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                id:
                                    type: number
                                    description: Request identifier
                                jsonrpc:
                                    type: string
                                    description: JSON-RPC version
                                    example: "2.0"
                                method:
                                    type: string
                                    description: Method name
                                    example: upload.calls
                                params:
                                    type: object
                                    properties:
                                        access_token:
                                            type: string
                                            description: Ключ сессии аутентификации
                                            example: example_string
                                        callback:
                                            type: object
                                            description: Уведомление об обработке звонка Формат уведомления JSON
                                        called_phone_number:
                                            type: string
                                            description: Номер куда звонили
                                            example: example_string
                                        calling_phone_number:
                                            type: string
                                            description: Номер звонящего
                                            example: example_string
                                        calls:
                                            type: array
                                            description: Список звонков. Максимально 500
                                            example: []
                                            items:
                                                type: string
                                                example: example_string
                                        campaign_id:
                                            type: number
                                            description: Уникальный идентификатор рекламной кампании в CoMagic. Параметр игнорируется, если заполнен visitor_session_id
                                            example: 123
                                        comment:
                                            type: string
                                            description: Комментарий к звонку. Можно указывать название сервиса или формы, которые сгенерировали звонок.
                                            example: example_string
                                        direction:
                                            type: string
                                            description: Направление звонка Значение по умолчанию 'in'
                                        employee_channel:
                                            type: string
                                            description: Указывает в каком канале находится сотрудник Значения только left или right
                                        employee_id:
                                            type: number
                                            description: Уникальный идентификатор сотрудника в системе CoMagic
                                            example: 123
                                        employee_name:
                                            type: string
                                            description: Название сотрудника (ФИО)Ищем сотрудника по названию (ФИО) в нашей системе, если не нашли, то создаем и связываем его со звонком. Если нашли, то связываем его со звонком. Поиск не чувствительный к регистру. Игнорируется, если заполнен employee_id
                                            example: example_string
                                        events:
                                            type: array
                                            description: Какие уведомления об обработке звонка получать
                                            example: []
                                            items:
                                                type: string
                                                example: example_string
                                        ext_id:
                                            type: string
                                            description: Уникальный идентификатор звонка в вашей системе. Если в системе уже есть успешно загруженный звонок или уже есть 3 попытки ошибочной загрузки звонка с данным ext_id, то данный звонок будет игнорирован.
                                            example: example_string
                                        finish_time:
                                            description: Время окончания сессии звонка. Не может быть меньше чем start_time
                                        is_lost:
                                            type: boolean
                                            description: Признак, что звонок потерянный или успешный
                                            example: true
                                        is_transfer:
                                            type: boolean
                                            description: Значение по умолчанию `false`. Признак, был ли трансфер в сессии звонка Порядок разговора сотрудников определяется в параметрах wav_records и mp3_records
                                            example: true
                                        mp3_records:
                                            type: array
                                            description: Файлы разговора для прослушивания в личном кабинете. Запрещено передавать, если заполнен параметр wav_records
                                            example: []
                                            items:
                                                type: string
                                                example: example_string
                                        record_url:
                                            type: string
                                            description: Адрес по которому можно скачать файл разговора
                                            example: example_string
                                        site_id:
                                            type: number
                                            description: Уникальный идентификатор сайта в CoMagic Параметр игнорируется, если заполнен visitor_session_id или called_phone_number принадлежит другому сайту.
                                            example: 123
                                        source_id:
                                            type: number
                                            description: Уникальный идентификатор источника. Возможно передать только неудаленный источник в разрезе клиента. Если передан visitor_session_id, то определим source_id по параметрам сессии.
                                            example: 123
                                        start_time:
                                            description: Дата и время начала сессии звонка
                                        tag_id:
                                            type: number
                                            description: Уникальный идентификатор тега в системе CoMagic
                                            example: 123
                                        tag_name:
                                            type: string
                                            description: Название тега. Ищем по названию тег в нашей системе, если не нашли, то создаем и ставим его на звонок. Если нашли, то ставим найденный тег на звонок. Поиск чувствительный к регистру. Для простановки тега "Продажа" необходимо использовать метод "set.tag_sales"Игнорируется, если заполнен tag_id
                                            example: example_string
                                        tags:
                                            type: array
                                            description: Теги звонка
                                            example: []
                                            items:
                                                type: string
                                                example: example_string
                                        talk_duration:
                                            type: number
                                            description: Длительность разговора - от момента первого разговора абонента с сотрудником до окончания разговора с последним сотрудником. Значение в секундах
                                            example: 123
                                        url:
                                            type: string
                                            description: http/https адрес на которые будет отправлено уведомление об успешной обработке звонка.
                                            example: example_string
                                        user_id:
                                            type: number
                                            description: Уникальный идентификатор пользователя клиента агента от имени которого делается запрос Является обязательным для агента Для получения списка пользователей клиента необходимо использовать метод "get.customer_users"
                                            example: 123
                                        visitor_session_id:
                                            type: number
                                            description: Уникальный идентификатор сессии посетителя полученной из CoMagic. Параметр нужен, если требуется аналитика рекламных кампаний.
                                            example: 123
                                        wait_duration:
                                            type: number
                                            description: Длительность ожидания абонента до первого разговора с сотрудником. Значение в секундах.
                                            example: 123
                                        wav_records:
                                            type: array
                                            description: Файлы разговора для речевой аналитики Возможно передать только если подключен компонент "Речевая аналитика звонков". Из wav-файлов автоматически создаются mp3-записи для прослушивания в личном кабинете
                                            example: []
                                            items:
                                                type: string
                                                example: example_string
                                    required:
                                        - is_lost
                                        - events
                                        - tag_name
                                        - calls
                                        - start_time
                                        - finish_time
                                        - access_token
                                        - calling_phone_number
                                        - record_url
                                        - ext_id
                                        - called_phone_number
                                        - employee_channel
                                        - url
                            required:
                                - jsonrpc
                                - id
                                - method
                                - params
            responses:
                "200":
                    description: Successful response
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    id:
                                        type: number
                                        description: Request identifier
                                    jsonrpc:
                                        type: string
                                        description: JSON-RPC version
                                        example: "2.0"
                                    result:
                                        type: object
                                        properties:
                                            data:
                                                type: object
                                            metadata:
                                                type: object
                                                description: Response metadata
                                        required:
                                            - data
                                            - metadata
                                required:
                                    - jsonrpc
                                    - id
                                    - result
                "400":
                    description: Error response
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error:
                                        type: object
                                        properties:
                                            code:
                                                type: number
                                            data:
                                                type: object
                                            message:
                                                type: string
                                    id:
                                        type: number
                                    jsonrpc:
                                        type: string
            tags:
                - novofon
